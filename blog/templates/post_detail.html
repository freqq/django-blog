{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block head_title %}
    {{instance.title}}
    |
    {{block.super}}
{% endblock head_title %}
{% block content %}

    <div class="col-sm-12">
        <img src="{{instance.image.url}}" class="img-responsive"/>
        <h1>{{title}}
            <small>
                {% if instance.draft %}
                    <span style="color:red;">Draft</span>
                {% endif %}
                {{instance.publish}}</small>
        </h1>
        <p>Author:
            {{instance.user}}</p>
        <div
            class="fb-like"
            data-href="https://developers.facebook.com/docs/plugins/"
            data-layout="button_count"
            data-action="like"
            data-size="small"
            data-show-faces="true"
            data-share="true"></div>
        <p class="post-detail-item">{{instance.get_markdown}}</p>

        <br/>
        <br/>
        <div>
            <p class="lead">Comments</p>

            <form method="POST" action=".">
                {% csrf_token %}
                {{comment_form|crispy}}
                <input type="submit" value="Post comment" class="btn btn-secondary"/>
            </form>

            <hr/>
            {% for comment in comments %}
                <blockquote class="blockquote">
                    <p class="mb-0">{{comment.content}}</p>
                    <footer class="blockquote-footer">via
                        {{comment.user}}
                        |
                        {{comment.timestamp|timesince}}
                        ago
                        {% if comment.children.count > 0 %} | {{comment.children.count}} comment {%if comment.children.count > 1 %}s{% endif %} {% endif %} 
                        | <a class="comment-reply-btn" href="#">Reply</a>
                    </footer>

                    <div class="comment-reply" style="display: none;">
                        {% for child_comment in comment.children %}
                            <blockquote class="blockquote">
                                <p class="mb-0">{{child_comment.content}}</p>
                                <footer class="blockquote-footer">via
                                    {{child_comment.user}}
                                    |
                                    {{child_comment.timestamp|timesince}}</footer>
                            </blockquote>
                        {% endfor %}

                        <form method="POST" action=".">
                            {% csrf_token %}
                            {{comment_form|crispy}}
                            <input type="hidden" name="parent_id" value="{{ comment.id }}"/>
                            <input type="submit" value="Reply" class="btn btn-secondary"/>
                        </form>
                    </div>
                </blockquote>
                <hr/>
            {% endfor %}
        </div>
    </div>
{% endblock content %}